@page "/Account/ForgotPassword"

@using System.ComponentModel.DataAnnotations
@using Microsoft.AspNetCore.Identity
@using ReMindHealth.Data

@inject UserManager<ApplicationUser> UserManager
@inject SignInManager<ApplicationUser> SignInManager
@inject ILogger<ForgotPassword> Logger
@inject NavigationManager NavigationManager

<PageTitle>Passwort zurücksetzen</PageTitle>

<div class="auth-container">
    <div class="auth-card">
        <h1>Passwort zurücksetzen</h1>
        <p class="subtitle">Geben Sie Ihre E-Mail und neues Passwort ein</p>

        @if (!string.IsNullOrEmpty(errorMessage))
        {
            <div class="alert alert-danger">
                @errorMessage
            </div>
        }

        @if (!string.IsNullOrEmpty(successMessage))
        {
            <div class="alert alert-success">
                @successMessage
            </div>
        }

        @if (!resetSuccessful)
        {
            <EditForm Model="Input" OnValidSubmit="ResetPasswordDirect" FormName="forgot-password">
                <DataAnnotationsValidator />
                <ValidationSummary class="text-danger" role="alert" />

                <div class="form-group">
                    <label for="email">E-Mail</label>
                    <InputText @bind-Value="Input.Email" class="form-control" autocomplete="username" placeholder="name@example.com" />
                    <ValidationMessage For="() => Input.Email" class="text-danger" />
                </div>

                <div class="form-group">
                    <label for="password">Neues Passwort</label>
                    <InputText type="password" @bind-Value="Input.NewPassword" class="form-control" autocomplete="new-password" placeholder="Mindestens 6 Zeichen" />
                    <ValidationMessage For="() => Input.NewPassword" class="text-danger" />
                </div>

                <div class="form-group">
                    <label for="confirm-password">Passwort bestätigen</label>
                    <InputText type="password" @bind-Value="Input.ConfirmPassword" class="form-control" autocomplete="new-password" placeholder="Passwort wiederholen" />
                    <ValidationMessage For="() => Input.ConfirmPassword" class="text-danger" />
                </div>

                <button type="submit" class="btn-submit" disabled="@isSubmitting">
                    @if (isSubmitting)
                    {
                        <span>Wird gespeichert...</span>
                    }
                    else
                    {
                        <span>Passwort zurücksetzen</span>
                    }
                </button>
            </EditForm>
        }
        else
        {
            <a href="/dashboard" class="btn-submit" style="display: block; text-align: center; text-decoration: none;">
                Zum Dashboard
            </a>
        }

        <div class="auth-footer">
            <p>
                Zurück zur
                <a href="/Account/Login">Anmeldung</a>
            </p>
        </div>
    </div>
</div>