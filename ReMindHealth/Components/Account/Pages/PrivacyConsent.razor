@page "/privacy-consent"
@attribute [Authorize]
@inject NavigationManager NavigationManager
@inject IUserService UserService
@rendermode InteractiveServer

<button class="zurueck-wrapper" @onclick='() => NavigationManager.NavigateTo("/dashboard")'>
    <img src="images/zurueck.png" alt="Zurück" class="zurueck-button" />
</button>

<div class="privacy-consent-container">
    <div class="consent-card">
        <h1>Einverständnis erforderlich</h1>
        <img src="images/einverstaenis.png" alt="Arztgespräch Illustration" class="mobile-image" />

        <div class="consent-text">
            <p class="primary-text">
                Bitte informieren Sie Ihren Arzt oder Ärztin, dass Sie das Gespräch aufnehmen möchten
            </p>
            <p class="secondary-text">
                Diese Aufnahme darf nur mit Zustimmung aller Beteiligten erfolgen
            </p>
        </div>

        <div class="checkbox-container">
            <label class="checkbox-label">
                <input type="checkbox" @bind="hasConsented" />
                <span class="checkmark"></span>
                <span class="checkbox-text">
                    Ich habe meinen Arzt/ meine Ärztin informiert
                </span>
            </label>
        </div>

        <button class="consent-button"
                @onclick="ConfirmConsent"
                disabled="@(!hasConsented)">
            Weiter zur Aufnahme
        </button>

        <div class="info-box">
            <p><strong>📋 Datenschutz:</strong></p>
            <ul>
                <li>Ihre Aufnahmen werden verschlüsselt gespeichert</li>
                <li>Nur Sie haben Zugriff auf Ihre Daten</li>
            </ul>
        </div>
    </div>
</div>

@code {
    private bool hasConsented = false;

    private async Task ConfirmConsent()
    {
        if (!hasConsented) return;

        try
        {
            var success = await UserService.AcceptPrivacyPolicyAsync();

            if (success)
            {
                NavigationManager.NavigateTo("/record");
            }
            else
            {
                Console.WriteLine("Failed to save consent");
            }
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error saving consent: {ex.Message}");
        }
    }
}